webpackJsonp([1],{"7kZU":function(t,e){},NHnr:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=n("/5sW"),o={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{attrs:{id:"app"}},[e("router-view",{staticClass:"router-view"})],1)},staticRenderFns:[]};var i=n("VU/8")({name:"App"},o,!1,function(t){n("7kZU")},"data-v-6fd8e4dc",null).exports,r=n("/ocq"),a=n("Gu7T"),c=n.n(a),p=n("mvHQ"),l=n.n(p),u=n("fZjL"),d=n.n(u),f=["#e12d2d","#f5a314","#fff838","#72ca2b","#529dff","#647cf7","#a855ec","#eb98de","#c08c8e","#d2ff8f"];function h(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e={};d()(t).forEach(function(n){var s=t[n].color;e[s]=!0});var n=[];if(f.forEach(function(t){e[t]||n.push(t)}),n.length){var s=Math.random()*n.length|0;return n[s]}for(var o="0123456789abcdef",i="#",r=0;r<6;r+=1)i+=o[Math.random()*o.length|0];return i}var y={name:"CVPoint",props:{fileContent:{type:String,default:"",required:!0},annoDetails:{type:Array,default:function(){return[]},required:!0},nowType:{type:String,default:"1234",required:!0},types:{type:Object,default:function(){},required:!0},save:{type:Function,required:!0}},data:function(){return{points:[],width:0,height:0}},methods:{log:function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];console.log(e)},addPoint:function(t){if(t.preventDefault(),this.nowType){var e=t.target,n=[t.offsetX/e.offsetWidth,t.offsetY/e.offsetHeight];return this.annoDetails.push({points:[n],type:this.nowType}),this.save(),!1}alert("请先选择标注类型")},delPoint:function(t){var e=this.annoDetails.indexOf(t);console.log(t,this.points),this.annoDetails.splice(e,1),this.save()},overPoint:function(t,e){3===t.which&&this.delPoint(e)}},watch:{annoDetails:{handler:function(t){console.log(t)},deep:!0}}},v={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"anno-img-box"},[n("div",{staticClass:"point-box"},[n("img",{staticClass:"anno-img",attrs:{id:"anno-img",src:"data:image/jpeg;base64,"+t.fileContent},on:{click:function(e){return t.addPoint(e)},dragstart:function(t){return t.preventDefault()},contextmenu:function(t){return t.preventDefault()}}}),t._v(" "),t._l(t.annoDetails,function(e){return n("div",{key:e.points[0][0]+"_"+e.points[0][1],staticClass:"point",style:{left:100*e.points[0][0]+"%",top:100*e.points[0][1]+"%",backgroundColor:t.types[e.type]?t.types[e.type].color:"#f00"},attrs:{point:e},on:{contextmenu:function(n){n.preventDefault(),t.delPoint(e)},mouseover:function(n){return t.overPoint(n,e)}}})})],2)])},staticRenderFns:[]};function m(t,e){w("GET",t,"",e,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{})}function g(t,e,n){w("POST",t,e,n,arguments.length>3&&void 0!==arguments[3]?arguments[3]:{})}function w(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",s=arguments[3],o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};o.tryTimes=o.tryTimes||0,o.isDirect=o.isDirect||!1;var i=new XMLHttpRequest;i.open(t,e),i.setRequestHeader("content-type","application/json"),i.onreadystatechange=function(){if(4===i.readyState&&200===i.status){if(o.isDirect)return s(i.responseText);var r=JSON.parse(i.responseText);0!==r.errCode?o.tryTimes>=2?alert(r.errMsg):setTimeout(function(){o.tryTimes+=1,w(t,e,n,s,o)},200):s&&s(r.info)}},i.send(l()(n))}function T(t,e,n){var s=e.map(function(t){return{type:t,color:n[t].color}});g("/v1/project/update_entity_types",{projectName:t,entityTypes:l()(s)})}var C={name:"NER",components:{CVPoint:n("VU/8")(y,v,!1,function(t){n("qI+P")},null,null).exports},data:function(){return{configCanCtlType:!1,pageNumber:1,pageSize:20,inputType:"",projectName:"",projectType:"",columnWordCount:10,files:[],textDic:{},startIdx:-1,endIdx:-1,nowFile:"",nowText:"",ners:[],nowNer:{},nowType:"",typeList:["person","location","organiztion"],isAnnoDic:{},nowFocus:"",fastKeyType:localStorage.fastKeyType?JSON.parse(localStorage.fastKeyType):{},fastTypeKey:localStorage.fastTypeKey?JSON.parse(localStorage.fastTypeKey):{},types:{person:{color:"#e61490"},location:{color:"#0aab8a"},organiztion:{color:"#2770cd"}},wordsType:[],wordsOutType:[],nersCache:{},mode:""}},computed:{wordColor:function(){return"#ff0000"},nowNers:function(){return this.nowNer?[].concat(c()(this.ners),[this.nowNer]):this.ners},processRate:function(){var t=this.files||[];if(!t.length)return 0;for(var e=this.nersCache||{},n=this.projectName||"",s=this.isAnnoDic||{},o=0,i=0;i<t.length;i+=1){var r=t[i];(s[n+"_"+r]||e[r]&&e[r].length)&&(o+=1)}return o/t.length}},methods:{log:function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];console.log(e)},getFiles:function(){var t=this;m("/v1/files/query?projectName="+t.projectName+"&pageNumber="+t.pageNumber+"&pageSize="+t.pageSize,function(e){e&&0!==e.length||(t.pageNumber-=1);var n=e.map(function(e){return"string"==typeof e?e:(t.isAnnoDic[t.projectName+"_"+e.fileName]=e.isAnno,e.fileName)});-1===t.files.indexOf(n[0])&&t.$set(t,"files",[].concat(c()(t.files),c()(n))),console.log(t.files),t.files[0]&&!t.nowFile&&t.setNowText(t.files[0])})},lastPage:function(){this.pageNumber>1&&(this.pageNumber=this.pageNumber-1,this.getFiles())},nextPage:function(){this.getFiles()},goHome:function(){this.$router.push({path:"/"})},save:function(){if(window.isLoadingNowText){if(Date.now()-window.isLoadingNowText<1e4)return alert("请等待文件内容加载"),!1;delete window.isLoadingNowText}return g("/v1/anno/create",{projectName:this.projectName,fileName:this.nowFile,annoDetails:this.ners}),this.$set(this.nersCache,this.nowFile,[].concat(c()(this.ners))),!0},setNowText:function(t){var e=this;window.isLoadingNowText=Date.now(),e.nowFile=t,e.nowText=e.textDic[t];var n=!!e.nersCache[t];e.$set(e,"ners",e.nersCache[t]?[].concat(c()(e.nersCache[t])):[]),e.flushWordsType(),e.nowText?delete window.isLoadingNowText:m("/v1/anno/query?projectName="+e.projectName+"&fileName="+t,function(s){delete window.isLoadingNowText,!n&&s.annoDetails&&(e.$set(e,"ners",s.annoDetails),e.$set(e.nersCache,e.nowFile,[].concat(c()(e.ners))),e.flushWordsType()),e.$set(e.textDic,t,s.fileContent),e.nowText=e.textDic[t]}),e.files.indexOf(t)>=e.files.length-1-2&&(e.pageNumber=e.pageNumber+1,e.getFiles());var s=document.getElementById(t),o=document.getElementById("file-list");s&&o&&(o.scrollTop=s.offsetTop-12-30)},changeIdx:function(t,e){e&&e.preventDefault();var n=this.files.indexOf(this.nowFile)+t;n<0&&(n=0),n>=this.files.length&&(n=this.files.length-1),this.setNowText(this.files[n])},pointWord:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("select"===this.mode){if(!this.nowType)return alert("请先选择标签"),!1;this.endIdx=t;var n=this.nowType,s=Math.min(this.startIdx,this.endIdx),o=Math.max(this.startIdx,this.endIdx)+1,i=this.nowText.substring(s,o);return this.$set(this,"nowNer",{name:i,type:n,start:s,end:o,isMove:!e.isDefaultClick}),t}},pointWordByTouch:function(t){t.preventDefault();var e=t.touches[0],n=e.pageX,s=e.pageY,o=document.elementFromPoint(n,s);o&&o.id&&this.pointWord(o.id)},setType:function(t,e){if("命名实体识别"===this.projectType)this.$set(this,"nowType",t);else if("文本分类"===this.projectType){var n=-1;this.ners.some(function(e,s){if(e.type===t)return n=s,e.type===t}),-1===n?this.ners.push({type:t}):this.ners.splice(n,1),this.$set(this,"nowType",t),this.save()}else console.log(t),this.$set(this,"nowType",t)},delType:function(t,e){if(!this.configCanCtlType)return!1;e&&e.preventDefault();for(var n={},s=[],o=this.typeList,i=this.types,r=0;r<o.length;r++){var a=o[r];t!==a&&(s.push(a),n[a]=i[a])}this.typeList=s,this.types=n,this.flushWordsType(),T(this.projectName,this.typeList,this.types)},checkDelType:function(t,e){if(!this.configCanCtlType)return!1;e&&e.stopPropagation(),window.confirm("确定删除标签【"+t+"】么？")&&this.delType(t)},addType:function(){var t=this.inputType;return document.getElementById("type-input").value="",this.inputType="",!!t&&(!this.types[t]&&(this.$set(this.types,t,{color:h(this.types)}),this.typeList.push(t),void T(this.projectName,this.typeList,this.types)))},typeInput:function(t){this.inputType=t.target.value,"Enter"!==t.code&&"NumpadEnter"!==t.code||this.addType(t)},setMode:function(t){"select"===this.mode&&this.endSelect(),this.mode=t},flushWordsType:function(){var t=JSON.parse(l()(this.ners));this.nowNer&&t.push(this.nowNer),this.wordsType=[];for(var e=0;e<t.length;e+=1)for(var n=t[e],s=n.start;s<n.end;s+=1)this.wordsType[s]=n.type;this.$set(this,"wordsType",this.wordsType),this.wordsOutType=[];for(var o=0;o<t.length;o+=1){for(var i=t[o],r=!1,a=i.start;a<i.end;a+=1)if(i.type!==this.wordsType[a]){r=!0;break}if(r)for(var c=i.start;c<i.end;c+=1)this.wordsOutType[c]=i.type}this.$set(this,"wordsOutType",this.wordsOutType)},delIdx:function(t){for(var e=this.ners,n=e.length-1;n>=0;n-=1){var s=e[n];if(t>=s.start&&t<s.end)return this.del(n),this.flushWordsType(),!0}},del:function(t){var e=this.ners;e.splice(t,1),this.$set(this,"ners",e),this.save()},startSelect:function(t,e){if("命名实体识别"===this.projectType){var n=this,s=!1;if(e.touches&&(setTimeout(function(){window.delMarkIdx===t&&(delete window.delMarkIdx,n.delIdx(t))},300),window.delMarkIdx=t),3===e.which&&(s=!0),s)return e.preventDefault(),this.delIdx(t),!0;this.setMode("select"),this.$set(this,"nowNer",{}),this.startIdx=t,this.endIdx=t,this.pointWord(t,{isDefaultClick:!0})}},stopSelect:function(){delete window.delMarkIdx},checkIsRepeat:function(t){for(var e=0;e<this.ners.length;e+=1){var n=this.ners[e];if(n.start===t.start&&n.end===t.end)return!0}return!1},endSelect:function(){if(!this.nowType)return!1;!this.checkIsRepeat(this.nowNer)&&this.nowNer.isMove&&this.nowNer.name&&(console.log(this.nowNer),delete this.nowNer.isMove,this.ners.push(this.nowNer),this.$set(this,"ners",this.ners.sort(function(t,e){return t.start-e.start+.001*(e.end-t.end)}))),this.$set(this,"nowNer",void 0),this.flushWordsType(),this.startIdx=-1,this.save()},stopPrev:function(t){t.preventDefault()},setFiles:function(t){t.stopPropagation(),t.preventDefault();var e=t.dataTransfer.files||[];this.processFiles(e)},processFiles:function(t){var e=this;e.$set(e,"files",[]),e.$set(e,"textDic",{});for(var n=function(n){var s=t[n],o=new FileReader;o.onload=function(t){e.$set(e.files,n,s.name),e.$set(e.textDic,s.name,t.target.result)},o.readAsText(s,"UTF-8")},s=0;s<t.length;s+=1)n(s)},outAllNers:function(){return"命名实体识别"===this.projectType?window.open("/v1/files/get_json?projectName="+this.projectName,"_self"):"文本分类"===this.projectType?m("/v1/files/get_labels?projectName="+this.projectName,function(t){var e,n,s,o,i;e=l()(JSON.parse(t)),n="labels.json",s=window.URL||window.webkitURL||window,o=new Blob([e]),(i=document.createElementNS("http://www.w3.org/1999/xhtml","a")).href=s.createObjectURL(o),i.download=n,i.click()},{isDirect:!0}):window.open("/v1/files/get_anno_json?projectName="+this.projectName,"_self"),!0},saveTxt:function(t,e){var n=document.createElement("a");n.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(e)),n.setAttribute("download",t),n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n)},setFastKey:function(t){console.log(t)},setTypeByFastKey:function(t){console.log(t)},setFocus:function(t){this.nowFocus=t},clickColor:function(t){document.getElementById(t).click()},changeColor:function(t,e){console.log(t,e.target.value),this.$set(this.types[t],"color",e.target.value),T(this.projectName,this.typeList,this.types)},isTypeSelected:function(t){return"命名实体识别"===this.projectType?this.nowType===t:"文本分类"===this.projectType?this.ners.some(function(e){return e.type===t}):this.nowType===t}},watch:{ners:function(){if("命名实体识别"===this.projectType)for(var t=void 0,e=0;e<this.ners.length;e++){var n=this.ners[e];delete n.isSmall,t&&n.start<=t&&(n.isSmall=!0),t||(t=n.end-1),t=Math.max(t,n.end-1)}}},mounted:function(){var t=this,e=t.$route.query,n=e.projectName,s=e.projectType,o=e.entityTypes;if(n){t.projectName=n,t.projectType=s,t.entityTypes=o?JSON.parse(o):[];var i={};t.typeList=t.entityTypes.map(function(t){return i[t.type]={color:t.color},t.type}),t.types=i,t.typeList&&t.typeList[0]&&-1===s.indexOf("分类")&&(t.nowType=t.typeList[0]),t.getFiles()}function r(){return(document.getElementById("ner-box").offsetWidth-30)/20|0}t.$set(t,"columnWordCount",r()),window.onresize=function(){t.$set(t,"columnWordCount",r())},window.onkeydown=function(e){if(t.nowFocus){var n=e.key;if("ner-box"===t.nowFocus){var s=t.fastKeyType[n];if(s)if("page-up"===s)t.changeIdx(-1);else if("page-down"===s)t.changeIdx(1);else{var o=t.fastKeyType[n];t.setType(o)}}else{var i=t.fastTypeKey[t.nowFocus];i&&t.$set(t.fastKeyType,i,void 0),"Escape"!==n&&t.$set(t.fastKeyType,n,t.nowFocus);var r={};for(var a in t.fastKeyType){r[t.fastKeyType[a]]=a}t.$set(t,"fastTypeKey",r),localStorage.fastKeyType=l()(t.fastKeyType),localStorage.fastTypeKey=l()(t.fastTypeKey)}}}}},_={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"layout"},[n("span",{staticClass:"home",on:{click:t.goHome}},[t._v("whaleAnno")]),t._v(" "),n("span",{staticClass:"now-file"},[t._v(t._s(t.nowFile))]),t._v(" "),n("h1",{staticClass:"out-title"},[t._v(t._s(t.projectName)+"（"+t._s(t.projectType)+"）")]),t._v(" "),n("div",{staticClass:"container",on:{dragover:t.stopPrev,drop:function(e){return t.setFiles(e)}}},[n("div",{staticClass:"left"},[n("div",{staticClass:"file-list",attrs:{id:"file-list"}},[t._l(t.files,function(e){return n("div",{key:e,class:["file",t.nowFile===e?"selected":"",t.isAnnoDic[t.projectName+"_"+e]||t.nersCache[e]&&t.nersCache[e].length?"checked":""].join(" "),attrs:{id:e,title:e},on:{click:function(n){return t.setNowText(e)}}},[t._v("\n          "+t._s(e)+"\n          "),t.isAnnoDic[t.projectName+"_"+e]||t.nersCache[e]&&t.nersCache[e].length?n("svg",{staticClass:"checked-icon",attrs:{t:"1619449859327",viewBox:"0 0 1152 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"1159",width:"16",height:"16"}},[n("path",{attrs:{d:"M4.266667 576l238.933333-187.733333 204.8 192c0 0 379.733333-328.533333 699.733333-512l0 123.733333C704 580.266667 426.666667 989.866667 426.666667 989.866667L4.266667 576 4.266667 576zM4.266667 576","p-id":"1160",fill:"#35e558"}})]):t._e()])}),t._v(" "),n("div",{staticClass:"process-bar",style:{width:100*t.processRate+"%"}})],2),t._v(" "),n("div",{staticClass:"page-ctl"},[n("span",{staticClass:"page-ctl-last",style:{opacity:1===t.pageNumber?0:1},on:{click:t.lastPage}},[t._v("上页")]),t._v(" "),n("span",{staticClass:"page-number",style:{opacity:1===t.pageNumber&&t.files.length<t.pageSize?0:1}},[t._v(t._s(t.pageNumber))]),t._v(" "),n("span",{staticClass:"page-ctl-next",style:{opacity:t.files.length<t.pageSize?0:1},on:{click:t.nextPage}},[t._v("下页")])]),t._v(" "),n("div",{staticClass:"out-btn",on:{click:t.outAllNers}},[t._v("导出json结果")])]),t._v(" "),n("div",{staticClass:"right"},[n("div",{staticClass:"title"},[n("span",[t._v("选择标签：")]),t._v(" "),n("div",{staticClass:"type-box"},[t._l(t.typeList,function(e){return n("span",{key:e,class:t.isTypeSelected(e)?"type selected":"type",style:{backgroundColor:t.types[e]?t.types[e].color:"#fff"},on:{click:function(n){return t.setType(e)},contextmenu:function(n){return t.delType(e,n)},mouseover:function(n){return t.setFocus(e)},mouseleave:function(e){return t.setFocus("")}}},[t.configCanCtlType?n("svg",{staticClass:"color-icon",attrs:{t:"1618942541356",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"1686",width:"18",height:"18"},on:{click:function(n){return n.stopPropagation(),t.clickColor(e,n)}}},[n("path",{attrs:{d:"M204.4 524.9c-14.5 1.5-26.2 13.2-27.7 27.7-2.1 19.9 14.6 36.7 34.6 34.6 14.5-1.5 26.2-13.2 27.8-27.8 2-19.9-14.8-36.6-34.7-34.5zM265.4 473.7c21.8-1.9 39.4-19.5 41.4-41.4 2.5-28.5-21.2-52.3-49.7-49.7-21.8 1.9-39.4 19.5-41.4 41.4-2.6 28.4 21.2 52.2 49.7 49.7zM415.8 266.9c-28.5 1.8-51.6 24.9-53.4 53.4-2.2 34.5 26.4 63.1 60.9 60.9 28.5-1.8 51.6-24.9 53.4-53.4 2.1-34.6-26.4-63.1-60.9-60.9zM621.9 253.8c-35.1 2.2-63.4 30.6-65.6 65.6-2.7 42.4 32.4 77.6 74.8 74.8 35.1-2.2 63.4-30.6 65.6-65.6 2.8-42.4-32.3-77.5-74.8-74.8zM966.5 276.4c-0.5-7.6-4-14.6-9.8-19.6l-0.7-0.6c-5.2-4.5-11.9-7-18.8-7-8.3 0-16.2 3.6-21.6 9.9L574 652.4l-43.5 85.5 1.1 0.9-4.9 11.3 11.1-5.9 1.5 1.3 78-54.3 342.3-394c5-5.8 7.4-13.2 6.9-20.8z","p-id":"1687",fill:"#2c3e50"}}),n("path",{attrs:{d:"M897.8 476.3c-13.8-1.4-26.7 7.4-30.4 20.7-6.9 24.6-19.3 64.5-35.1 97.8C809.5 643 767.4 710.1 696.7 756c-72.2 46.9-142.7 56.7-189.2 56.7-37 0-72.2-6.1-101.7-17.7-26.9-10.5-46.4-24.6-54.9-39.7-3.4-6.1-7.2-12.9-11.2-20.2-17.2-31.1-36.6-66.5-49.7-77.4-15.9-13.2-39.1-15-59.8-15-8.1 0-40.8 1.3-48.5 1.3-33.1 0-49.4-6.5-56.1-22.4-17.8-42.3-7.3-114.3 26.8-183.4C205.2 331.4 300 253.3 412.6 224c40-10.6 81.2-18.9 121.3-18.9 85.6 0 187.8 32.8 252.5 77.2 11.4 7.8 26.9 5.8 35.7-4.9 10.4-12.6 7.1-31.4-6.8-39.8-23.3-14-57.9-34-86.3-47.1-60.3-27.9-123.7-41.9-189.2-41.9-68.1 0-148.8 16.4-217.2 47.2-78.1 35-135.2 85-179.4 147.5-36.4 51.4-67.8 111.1-80.1 168.7-7.5 35.1-6.8 57.4-2.4 87.8 4.2 29.2 13.4 52.5 26.9 67.5 22.4 25.1 51.5 37.4 89 37.4 13.9 0 56.3-5 63.1-5 7.4 0 12.2 1.2 14.4 3.8 6.4 7.4 14.4 22.4 23.7 39.9 7.5 14.1 15.9 30.1 25.4 45.3 12.1 19.5 36.9 40.4 66.5 55.9 27 14.1 71.9 31 132.2 31 72 0 148.3-23.6 226.7-70.1 74.9-44.4 123-118.9 150.2-173.6 19-38.3 34.7-87.2 43.8-119.1 4.8-17.3-7-34.7-24.8-36.5z","p-id":"1688",fill:"#2c3e50"}})]):t._e(),t._v(" "),t.configCanCtlType?n("input",{staticClass:"color-input",attrs:{id:e,type:"color"},domProps:{value:t.types[e].color},on:{change:function(n){return t.changeColor(e,n)},click:function(t){t.stopPropagation()}}}):t._e(),t._v("\n            "+t._s(e)+" "+t._s(t.fastTypeKey[e]?"【"+t.fastTypeKey[e]+"】":"")+"\n            "),t.configCanCtlType?n("svg",{staticClass:"close-icon",attrs:{t:"1618943942999",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"3793",width:"18",height:"18"},on:{click:function(n){return t.checkDelType(e,n)}}},[n("path",{attrs:{d:"M512 421.504l274.752-274.752 90.496 90.496L602.496 512l274.752 274.752-90.496 90.496L512 602.496l-274.752 274.752-90.496-90.496L421.504 512 146.752 237.248l90.496-90.496z","p-id":"3794",fill:"#ff0000"}})]):t._e()])}),t._v(" "),t.configCanCtlType?n("span",{staticClass:"type-input-box"},[n("input",{staticClass:"type-input",attrs:{id:"type-input",placeholder:"新增标签"},on:{keypress:t.typeInput,change:t.typeInput}}),t._v(" "),n("button",{staticClass:"page-btn",on:{click:t.addType}},[t._v("提交")])]):t._e()],2)]),t._v(" "),n("div",{staticClass:"ner-box",attrs:{id:"ner-box"},on:{mouseup:function(e){return t.setMode("")},touchend:function(e){return t.setMode("")},mouseleave:function(e){t.setMode(""),t.setFocus("")},keydown:t.setTypeByFastKey,mouseover:function(e){return t.setFocus("ner-box")}}},["命名实体识别"===t.projectType?n("div",[n("div",{staticClass:"word-rect-area"},t._l(t.nowNers,function(e,s){return n("span",{key:s,staticClass:"rect"},t._l(e.name,function(s,o){return n("span",{key:""+e+s+o},[0===o||(e.start%t.columnWordCount+o)%t.columnWordCount==0?n("span",{staticClass:"ner-anchor",style:{border:"1px solid #ccc",position:"absolute",display:"inline-block",left:(e.start+o)%t.columnWordCount*20+(e.isSmall&&0===o?2:0)+"px",top:35*((e.start+o)/t.columnWordCount|0)+(e.isSmall?0:-2)+"px",width:20*Math.min(e.end-(e.start+o),t.columnWordCount,t.columnWordCount-(e.start+o)%t.columnWordCount)-(e.isSmall&&0===o?4:0)+"px",height:(e.isSmall?18:22)+"px",background:""+(t.types[e.type]?t.types[e.type].color:"000000"),lineHeight:"25px",borderTopLeftRadius:(0===o?6:0)+"px",borderBottomLeftRadius:(0===o?6:0)+"px",borderLeft:(0===o?1:0)+" solid #ccc",borderTopRightRadius:(0!==o&&e.name.length-o<=t.columnWordCount||0===o&&e.start%t.columnWordCount+e.name.length<=t.columnWordCount?6:0)+"px",borderBottomRightRadius:(0!==o&&e.name.length-o<=t.columnWordCount||0===o&&e.start%t.columnWordCount+e.name.length<=t.columnWordCount?6:0)+"px",borderRight:(0!==o&&e.name.length-o<=t.columnWordCount||0===o&&e.start%t.columnWordCount+e.name.length<t.columnWordCount?1:0)+" solid #ccc"}}):t._e()])}),0)}),0)]):t._e(),t._v(" "),"命名实体识别"===t.projectType?n("div",t._l(t.nowText,function(e,s){return n("span",{key:s,staticClass:"word",attrs:{id:s},on:{contextmenu:t.stopPrev,mousedown:function(e){return t.startSelect(s,e)},touchstart:function(e){return t.startSelect(s,e)},touchend:function(e){return t.stopSelect()},mousemove:function(e){return t.pointWord(s)},touchmove:function(e){return t.pointWordByTouch(e)}}},[t._v("\n            "+t._s(e)+"\n          ")])}),0):t._e(),t._v(" "),"文本分类"===t.projectType?n("div",[t._l(t.nowText,function(e,s){return["\n"!==e?n("span",{key:s,staticClass:"word",on:{contextmenu:t.stopPrev,mousedown:function(e){return t.startSelect(s,e)},mousemove:function(e){return t.pointWord(s)}}},[t._v(t._s(e))]):t._e(),t._v(" "),"\n"===e?n("br",{key:s}):t._e()]})],2):t._e(),t._v(" "),"图片点标注"===t.projectType?n("CVPoint",{attrs:{fileContent:t.nowText,annoDetails:t.ners,nowType:t.nowType,types:t.types,save:t.save}}):t._e()],1),t._v(" "),n("div",{staticClass:"page-btn-box"},[n("button",{staticClass:"page-btn",on:{click:function(e){return t.changeIdx(-1,e)},mouseover:function(e){return t.setFocus("page-up")},mouseleave:function(e){return t.setFocus("")}}},[t._v("上一个 "+t._s(t.fastTypeKey["page-up"]?"【"+t.fastTypeKey["page-up"]+"】":""))]),t._v(" "),n("button",{staticClass:"page-btn",on:{click:function(e){return t.changeIdx(1,e)},mouseover:function(e){return t.setFocus("page-down")},mouseleave:function(e){return t.setFocus("")}}},[t._v("下一个 "+t._s(t.fastTypeKey["page-down"]?"【"+t.fastTypeKey["page-down"]+"】":""))])])]),t._v(" "),n("div",{staticClass:"result-box"},t._l(t.ners,function(e,s){return n("div",{key:s,staticClass:"result",class:t.nowType===e.type?"result selected":"result",style:{backgroundColor:t.types[e.type]?t.types[e.type].color:"#fff"}},[n("span",{staticClass:"result-name"},[t._v(t._s(e.name)+"\n          "),n("svg",{staticClass:"result-name-del",attrs:{t:"1649340286830",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"5736",width:"17",height:"17"},on:{click:function(e){return t.del(s)}}},[n("path",{attrs:{d:"M916.945455 251.345455H768V190.836364c0-48.872727-39.563636-90.763636-88.436364-90.763637h-302.545454c-48.872727 0-90.763636 39.563636-90.763637 90.763637v60.509091H137.309091c-16.290909 0-30.254545 13.963636-30.254546 30.254545 0 16.290909 13.963636 30.254545 30.254546 30.254545h777.309091c16.290909 0 30.254545-13.963636 30.254545-30.254545 0-16.290909-11.636364-30.254545-27.927272-30.254545zM346.763636 190.836364c0-16.290909 13.963636-30.254545 30.254546-30.254546h300.218182c16.290909 0 30.254545 13.963636 30.254545 30.254546v60.509091H346.763636V190.836364z m0 0M646.981818 730.763636V400.290909c0-16.290909-13.963636-30.254545-30.254545-30.254545-16.290909 0-30.254545 13.963636-30.254546 30.254545v328.145455c0 16.290909 13.963636 30.254545 30.254546 30.254545 16.290909 2.327273 30.254545-11.636364 30.254545-27.927273z m0 0M467.781818 730.763636V400.290909c0-16.290909-13.963636-30.254545-30.254545-30.254545-16.290909 0-30.254545 13.963636-30.254546 30.254545v328.145455c0 16.290909 13.963636 30.254545 30.254546 30.254545 16.290909 2.327273 30.254545-11.636364 30.254545-27.927273z m0 0","p-id":"5737",fill:"#d81e06"}}),n("path",{attrs:{d:"M795.927273 372.363636c-16.290909 0-30.254545 13.963636-30.254546 30.254546v449.163636c0 16.290909-13.963636 30.254545-30.254545 30.254546h-418.909091c-16.290909 0-30.254545-13.963636-30.254546-30.254546V400.290909c0-16.290909-13.963636-30.254545-30.254545-30.254545-16.290909 0-30.254545 13.963636-30.254545 30.254545v449.163636c0 48.872727 39.563636 90.763636 90.763636 90.763637h418.909091c48.872727 0 90.763636-39.563636 90.763636-90.763637V402.618182c0-16.290909-13.963636-30.254545-30.254545-30.254546z m0 0","p-id":"5738",fill:"#d81e06"}})])])])}),0)])])},staticRenderFns:[]};var x=n("VU/8")(C,_,!1,function(t){n("oNif")},"data-v-1aa2d9bc",null).exports;function N(t,e){j("GET",t,"",e)}function j(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",s=arguments[3],o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},i=new XMLHttpRequest;i.open(t,e),o.contentType||i.setRequestHeader("content-type","application/json"),i.onreadystatechange=function(){if(4===i.readyState&&200===i.status){var t=JSON.parse(i.responseText);0!==t.errCode?alert(t.errMsg):s&&s(t.info)}},"multipart/form-data"===o.contentType?i.send(n):i.send(l()(n))}var b={name:"home",data:function(){return{projects:[],projectName:"",projectType:"",page:"list",types:{},typeList:[]}},computed:{},watch:{projectName:console.log},methods:{goHome:function(){this.page="list"},setName:function(t){this.projectName=t.target.value},setType:function(t){this.projectType=t.target.value},del:function(){var t=this;prompt("请输入"+this.projectName+"来确认删除。")===this.projectName?N("/v1/project/delete_program?projectName="+this.projectName,function(){t.init()}):alert("输入错误，删除失败")},init:function(){var t=this;t.type="",t.projectName="",N("/v1/index",function(e){t.$set(t,"projects",e),t.projectName="",t.projectType="",t.page="list"})},submit:function(){var t,e,n=this,s=n.typeList.map(function(t){return{type:t,color:n.types[t].color}}),o=n.projectName;t="/v1/project/create",e={projectName:n.projectName,projectType:n.projectType,entityTypes:l()(s)},j("POST",t,e,function(){n.init();var t,e=document.getElementById("file-input");if(e.files[0]){var s=new FormData;s.append("projectName",o),s.append("file",e.files[0]),j("POST","/v1/project/get_zipped_data",s,t,{contentType:"multipart/form-data"})}})},toNerAnno:function(t){var e=t.projectName,n=t.projectType,s=t.entityTypes;this.$router.push({path:"/NER",query:{projectName:e,projectType:n,entityTypes:s}})},toEdit:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};console.log("project",t),this.projectName=t.projectName||"",this.projectType=t.projectType||"命名实体识别",this.page=t.projectName?"edit":"create";var e=t.entityTypes?JSON.parse(t.entityTypes):[],n={};this.typeList=e.map(function(t){return n[t.type]={color:t.color},t.type}),this.types=n},toList:function(){this.page="list"},addType:function(){var t=this.inputType;return document.getElementById("type-input").value="",this.inputType="",!!t&&(!this.types[t]&&(this.$set(this.types,t,{color:h(this.types)}),this.typeList.push(t),void console.log(this.typeList)))},delType:function(t,e){e&&e.preventDefault();for(var n={},s=[],o=this.typeList,i=this.types,r=0;r<o.length;r++){var a=o[r];t!==a&&(s.push(a),n[a]=i[a])}this.typeList=s,this.types=n},checkDelType:function(t,e){e&&e.stopPropagation(),window.confirm("确定删除标签【"+t+"】么？")&&this.delType(t)},typeInput:function(t){this.inputType=t.target.value,"Enter"!==t.code&&"NumpadEnter"!==t.code||this.addType(t)},clickColor:function(t){document.getElementById(t).click()},changeColor:function(t,e){console.log(t,e.target.value),this.$set(this.types[t],"color",e.target.value)}},mounted:function(){var t=this;N("/v1/index",function(e){t.$set(t,"projects",e)})}},k={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"layout"},[n("h1",{staticClass:"out-title"},[n("span",{staticClass:"home",on:{click:t.goHome}},[t._v("whaleAnno")])]),t._v(" "),n("div",{staticClass:"container"},["list"===t.page?n("div",{staticClass:"project-box"},[n("div",{staticClass:"project-box-titile"},[n("h3",{staticClass:"inner-title"},[t._v("我的项目")]),t._v(" "),n("div",{staticClass:"btn-area"},[n("button",{staticClass:"button",on:{click:function(e){return t.toEdit()}}},[t._v("新建项目")])])]),t._v(" "),n("div",{staticClass:"list-box"},[0===t.projects.length?n("div",{staticClass:"project",staticStyle:{border:"none",color:"#ccc"}},[t._v("暂无")]):t._e(),t._v(" "),t._l(t.projects,function(e){return n("div",{key:e.projectName,staticClass:"project"},[n("p",{staticClass:"projectName"},[t._v(t._s(e.projectName))]),t._v(" "),n("p",{staticClass:"projectType"},[t._v(t._s(e.projectType))]),t._v(" "),n("div",{staticClass:"btn-area"},[n("button",{staticClass:"button",on:{click:function(n){return t.toNerAnno(e)}}},[t._v("开始标注")]),t._v(" "),n("button",{staticClass:"button",on:{click:function(n){return t.toEdit(e)}}},[t._v("配置")])])])})],2)]):t._e(),t._v(" "),"edit"===t.page||"create"===t.page?n("div",{staticClass:"edit-box"},[n("p",[t._v("名称："),n("input",{staticClass:"name-input",attrs:{type:"text",name:"name",disabled:"edit"===t.page},domProps:{value:t.projectName},on:{change:t.setName}})]),t._v(" "),n("p",[t._v("类型：\n        "),n("select",{staticClass:"type-input",attrs:{name:"type"},domProps:{value:t.projectType},on:{change:t.setType}},[n("option",{attrs:{value:"命名实体识别"}},[t._v("命名实体识别")]),t._v(" "),n("option",{attrs:{value:"文本分类"}},[t._v("文本分类")]),t._v(" "),n("option",{attrs:{value:"图片点标注"}},[t._v("图片点标注")])])]),t._v(" "),n("div",{staticClass:"title"},[n("span",[t._v("选择标签：")]),t._v(" "),n("br"),t._v(" "),n("div",{staticClass:"type-box"},[t._l(t.typeList,function(e){return n("span",{key:e,staticClass:"type",style:{backgroundColor:t.types[e]?t.types[e].color:"#fff"},on:{contextmenu:function(n){return t.delType(e,n)}}},[n("svg",{staticClass:"color-icon",attrs:{t:"1618942541356",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"1686",width:"18",height:"18"},on:{click:function(n){return n.stopPropagation(),t.clickColor(e,n)}}},[n("path",{attrs:{d:"M204.4 524.9c-14.5 1.5-26.2 13.2-27.7 27.7-2.1 19.9 14.6 36.7 34.6 34.6 14.5-1.5 26.2-13.2 27.8-27.8 2-19.9-14.8-36.6-34.7-34.5zM265.4 473.7c21.8-1.9 39.4-19.5 41.4-41.4 2.5-28.5-21.2-52.3-49.7-49.7-21.8 1.9-39.4 19.5-41.4 41.4-2.6 28.4 21.2 52.2 49.7 49.7zM415.8 266.9c-28.5 1.8-51.6 24.9-53.4 53.4-2.2 34.5 26.4 63.1 60.9 60.9 28.5-1.8 51.6-24.9 53.4-53.4 2.1-34.6-26.4-63.1-60.9-60.9zM621.9 253.8c-35.1 2.2-63.4 30.6-65.6 65.6-2.7 42.4 32.4 77.6 74.8 74.8 35.1-2.2 63.4-30.6 65.6-65.6 2.8-42.4-32.3-77.5-74.8-74.8zM966.5 276.4c-0.5-7.6-4-14.6-9.8-19.6l-0.7-0.6c-5.2-4.5-11.9-7-18.8-7-8.3 0-16.2 3.6-21.6 9.9L574 652.4l-43.5 85.5 1.1 0.9-4.9 11.3 11.1-5.9 1.5 1.3 78-54.3 342.3-394c5-5.8 7.4-13.2 6.9-20.8z","p-id":"1687",fill:"#2c3e50"}}),n("path",{attrs:{d:"M897.8 476.3c-13.8-1.4-26.7 7.4-30.4 20.7-6.9 24.6-19.3 64.5-35.1 97.8C809.5 643 767.4 710.1 696.7 756c-72.2 46.9-142.7 56.7-189.2 56.7-37 0-72.2-6.1-101.7-17.7-26.9-10.5-46.4-24.6-54.9-39.7-3.4-6.1-7.2-12.9-11.2-20.2-17.2-31.1-36.6-66.5-49.7-77.4-15.9-13.2-39.1-15-59.8-15-8.1 0-40.8 1.3-48.5 1.3-33.1 0-49.4-6.5-56.1-22.4-17.8-42.3-7.3-114.3 26.8-183.4C205.2 331.4 300 253.3 412.6 224c40-10.6 81.2-18.9 121.3-18.9 85.6 0 187.8 32.8 252.5 77.2 11.4 7.8 26.9 5.8 35.7-4.9 10.4-12.6 7.1-31.4-6.8-39.8-23.3-14-57.9-34-86.3-47.1-60.3-27.9-123.7-41.9-189.2-41.9-68.1 0-148.8 16.4-217.2 47.2-78.1 35-135.2 85-179.4 147.5-36.4 51.4-67.8 111.1-80.1 168.7-7.5 35.1-6.8 57.4-2.4 87.8 4.2 29.2 13.4 52.5 26.9 67.5 22.4 25.1 51.5 37.4 89 37.4 13.9 0 56.3-5 63.1-5 7.4 0 12.2 1.2 14.4 3.8 6.4 7.4 14.4 22.4 23.7 39.9 7.5 14.1 15.9 30.1 25.4 45.3 12.1 19.5 36.9 40.4 66.5 55.9 27 14.1 71.9 31 132.2 31 72 0 148.3-23.6 226.7-70.1 74.9-44.4 123-118.9 150.2-173.6 19-38.3 34.7-87.2 43.8-119.1 4.8-17.3-7-34.7-24.8-36.5z","p-id":"1688",fill:"#2c3e50"}})]),t._v(" "),n("input",{staticClass:"color-input",attrs:{id:e,type:"color"},domProps:{value:t.types[e].color},on:{change:function(n){return t.changeColor(e,n)},click:function(t){t.stopPropagation()}}}),t._v("\n            "+t._s(e)+"\n            "),n("svg",{staticClass:"close-icon",attrs:{t:"1618943942999",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"3793",width:"18",height:"18"},on:{click:function(n){return t.checkDelType(e,n)}}},[n("path",{attrs:{d:"M512 421.504l274.752-274.752 90.496 90.496L602.496 512l274.752 274.752-90.496 90.496L512 602.496l-274.752 274.752-90.496-90.496L421.504 512 146.752 237.248l90.496-90.496z","p-id":"3794",fill:"#ff0000"}})])])}),t._v(" "),n("span",{staticClass:"type-input-box"},[n("input",{staticClass:"type-input",attrs:{id:"type-input",placeholder:"新增标签"},on:{keypress:t.typeInput,change:t.typeInput}}),t._v(" "),n("button",{staticClass:"page-btn",on:{click:t.addType}},[t._v("提交")])])],2)]),t._v(" "),n("p",[t._v("上传文本：")]),t._v(" "),n("p",{staticStyle:{"font-size":"10px"}},[t._v("（请选择包含文本文件的zip、tar文件）")]),t._v(" "),n("input",{attrs:{type:"file",id:"file-input",accept:".zip,.tar"}}),t._v(" "),n("p",{staticClass:"edit-box-btn-area"},["edit"===t.page?n("button",{staticClass:"button danger",on:{click:t.del}},[t._v("删除")]):t._e(),t._v(" "),n("button",{staticClass:"button",on:{click:t.submit}},[t._v("提交")]),t._v(" "),n("button",{staticClass:"button",on:{click:t.toList}},[t._v("取消")])])]):t._e()])])},staticRenderFns:[]};var L=n("VU/8")(b,k,!1,function(t){n("OVY+")},"data-v-c84d5e70",null).exports;s.default.use(r.a);var M=new r.a({routes:[{path:"/NER",name:"NER",component:x,props:{entityTypes:!0}},{path:"/",name:"home",component:L,props:!0}]}),S=n("zL8q");s.default.config.productionTip=!1,s.default.use(S.Button),s.default.use(S.Select),s.default.use(S.Menu),s.default.use(S.MenuItem),new s.default({el:"#app",router:M,render:function(t){return t(i)}})},"OVY+":function(t,e){},oNif:function(t,e){},"qI+P":function(t,e){}},["NHnr"]);
//# sourceMappingURL=app.aa3fafefaf60a2ada43c.js.map